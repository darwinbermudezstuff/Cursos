@model Storage.Models.Assignment.AssignmentViewModels


@using (Html.BeginForm())
{
    @Html.AntiForgeryToken()
    @Html.ValidationSummary(true, "", new { @class = "text-danger" })
    <div class="form-horizontal">
        @*<hr />
        <h1>Create Assignment</h1>
        <hr />*@
        <div class="form-horizontal">


            <div class="form-group">
                <div class="col-md-6">
                    <div class="form-group">
                        <div class="col-md-10">
                            <h4>Product Assignment Information</h4>
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.Product, new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.DropDownListFor(m => m.Assignment.idProduct, new SelectList(Model.ProductList, "id", "name", 0), "Please Select Category", new { @class = "form-control ProductSelected" })
                            @Html.ValidationMessageFor(model => model.Assignment.idProduct, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(m => m.Employees, new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.DropDownListFor(m => m.Assignment.idEmployee, new SelectList(Model.EmployeesList, "id", "firstName", "lastName", 0), "Please Select Category", new { @class = "form-control" })
                            @Html.ValidationMessageFor(model => model.Assignment.idEmployee, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.Assignment.Min, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Assignment.Min, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Assignment.Min, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group">
                        @Html.LabelFor(model => model.Assignment.Max, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Assignment.Max, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Assignment.Max, "", new { @class = "text-danger" })
                        </div>
                    </div>


                    <div class="form-group">
                        @Html.LabelFor(model => model.Assignment.detail, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Assignment.detail, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Assignment.detail, "", new { @class = "text-danger" })
                        </div>
                    </div>

                </div>

                <div class="col-md-6">
                    <div class="form-group">
                        <div class="col-md-10">
                            <h4>Assignment Infomation</h4>
                        </div>
                    </div>


                    <div class="form-group">
                        @Html.LabelFor(model => model.Transaction.idConditionProduct, new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.DropDownListFor(m => m.Transaction.idConditionProduct, new SelectList(Model.ConditionProductList, "id", "name", 0), "Please Select Category", new { @class = "form-control ConditionSelect" })
                            @Html.ValidationMessageFor(model => model.Transaction.idConditionProduct, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Transaction.amount, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Transaction.amount, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Transaction.amount, "", new { @class = "text-danger" })
                        </div>
                    </div>
                    <div class="form-group ActualAmountValueAlert" style="display:none;">
                        @Html.Label("actualAmount", "Actual Amount Condition", htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            <div class="alert alert-info" role="alert"><label class="ActualAmountConditionValue" /></div>
                        </div>
                    </div>
                    <div class="form-group ActualAmountValueAlert" style="display:none;">
                        @Html.Label("actualAmount", "Current Amount", htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            <div class="alert alert-info" role="alert"><label class="ActualAmountTotalValue" /></div>
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Transaction.detail, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Transaction.detail, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Transaction.detail, "", new { @class = "text-danger" })
                        </div>
                    </div>

                    <div class="form-group">
                        @Html.LabelFor(model => model.Transaction.createDate, htmlAttributes: new { @class = "control-label col-md-4" })
                        <div class="col-md-6">
                            @Html.EditorFor(model => model.Transaction.createDate, new { htmlAttributes = new { @class = "form-control" } })
                            @Html.ValidationMessageFor(model => model.Transaction.createDate, "", new { @class = "text-danger" })
                        </div>
                    </div>
            </div>
            </div>
        </div>

        <div class="form-group">
            <div class="col-md-10">
                @Html.HiddenFor(model => model.Assignment.id)
                @Html.HiddenFor(model => model.CategoryID)
                @Html.HiddenFor(model => model.CategoryIDFhater)
                @Html.HiddenFor(model => model.CellarArea)
                @Html.HiddenFor(model => model.Assignment.loan)
                @Html.HiddenFor(model => model.Assignment.idCategory)
                @Html.HiddenFor(model => model.Assignment.createDate)
                @Html.HiddenFor(model => model.Assignment.state)
                <input type="submit" value="Create" class="btn btn-default" />
            </div>
        </div>
    </div>

            <script type="text/javascript">
                        $(document).ready(function () {
                            var ProductID = "";
                            var ConditionID = "";

                            $(".ProductSelected").change(function () {
                                ProductID = "";
                                ConditionID = "";
                                $(".ProductSelected option:selected").each(function () { ProductID += $(this)[0].value; });
                                $(".ConditionSelect option:selected").each(function () { ConditionID += $(this)[0].value; });
                                amountProduct(ProductID, ConditionID);
                            });


                            $(".ConditionSelect").change(function () {
                                ProductID = "";
                                ConditionID = "";
                                $(".ProductSelected option:selected").each(function () { ProductID += $(this)[0].value; });
                                $(".ConditionSelect option:selected").each(function () { ConditionID += $(this)[0].value; });
                                console.log("Producto: " + ProductID + " \n Condicion: " + ConditionID);
                                amountProduct(ProductID, ConditionID);
                            });

                        });

                        function amountProduct(ProductID, conditionID) {
                            if (ProductID.length > 0 && conditionID.length > 0) {
                                var actionLink = '@Url.Action("ActualAmountByAssignment", "Assignment")';
                                var cellarArea = '@Model.CellarArea';
                                var url = actionLink + "?ProductID=" + ProductID + "&CellarArea=" + cellarArea + "&condition=" + conditionID + "&transactionType=" + 1;
                                console.log(url);
                                $.ajax({
                                    type: 'GET',
                                    url: url,
                                    async: false,
                                    beforeSend: function (xhr) {
                                        if (xhr && xhr.overrideMimeType) {
                                            xhr.overrideMimeType('application/json;charset=utf-8');
                                        }
                                    },
                                    dataType: 'json',
                                    success: function (data) {
                                        $(".ActualAmountValueAlert").show();
                                        $(".ActualAmountConditionValue").html(data.AmountCondition);
                                        $(".ActualAmountTotalValue").html(data.AmountTotal);
                                    }
                                });
                            }
                        };
            </script>
            }
